# 081 커서(Cursor)

## 1 커서의 개념

- 커서는 쿼리문의 처리 결과가 저장되어 있는 메모리 공간을 가리키는 포인터(Pointer)이다
- 커서는 내부에서 자동으로 생성되어 사용되는 묵시적 커서와, 사용자가 직접 정의해서 사용하는 명시적 커서가 있다
- 커서의 수행은 열기(Open), 패치(Fetch), 닫기(Close)의 세 단계로 진행된다
- 묵시적 커서는 각 단계가 자동으로 수행되지만, 명시적 커서는 직접 구현해야 한다
- 묵시적 커서는 수행된 쿼리문의 정상적인 수행 여부를 확인하기 위해 사용되며, 명시적 커서는 쿼리문의 결과를 저장하여 사용함으로써 동일한 쿼리가 반복 수행되어 데이터베이스 자원이 낭비되는 것을 방지한다



## 2 묵시적 커서(Implicit Cursor)

- 묵시적 커서는 DBMS 자체적으로 열리고(Open) 패치(Fetch)되어 사용이 끝나면 닫히지만(Close) 커서의 속성을 조회하여 사용된 쿼리 정보를 열람하는 것이 가능하다
- 커서의 속성
  - SQL%FOUND : 쿼리 수행의 결과로 패치(Fetch)된 튜플 수가 1개 이상이면 TRUE
  - SQL%NOTFOUND : 쿼리 수행의 결과로 패치(Fetch)된 튜플 수가 0개이면 TRUE
  - SQL%ROWCOUNT : 쿼리 수행의 결과로 패치(Fetch)된 튜플 수를 반환
  - SQL%ISOPEN
    - 커서가 열린(Open) 상태이면 TRUE
    - 묵시적 커서는 자동으로 생성된 후 자동으로 닫히기 때문에 항상 FALSE



## 3 명시적 커서(Explicit Cursor)

- 명시적 커서는 사용자가 직접 정의해서 사용하는 커서로, 주로 절차형 SQL에서 SELECT문의 결과로 반환되는 여러 튜플들을 제어하기 위해 사용된다

- 커서는 기본적으로 '열기(Open) - 패치(Fetch) - 닫기(Close)' 순으로 이루어지며, 명시적 커서로 사용하기 위해서는 열기 전에 선언(Declare)을 해야 한다

- 선언(Declare) 형식

  - ```sql
    CURSOR 커서명(매개변수1, 매개변수2, ...)
    IS
    SELECT문;
    ```

- 열기(Open) 형식

  - ```sql
    OPEN 커서명(매개변수1, 매개변수2, ...);
    ```

- 패치(Fetch) 형식

  - ```sql
    FETCH 커서명 INTO 변수1, 변수2 ...;
    ```

- 닫기(Close) 형식

  - ```sql
    CLOSE 커서명;
    ```



