# 076 DML - SELECT - 2

## 1 일반 형식

- ```SQL
  SELECT [PREDICATE] [테이블명.]속성명 [AS 별칭][, [테이블명.]속성명, ...]
  [, 그룹함수(속성명) [AS 별칭]]
  [, WINDOW함수 OVER (PARTITION BY 속성명1, 속성명2, ...
                   ORDER BY 속성명3, 속성명4, ...) [AS 별칭]]
  FROM 테이블명[, 테이블명, ...]
  [WHERE 조건]
  [GROUP BY 속성명, 속성명, ...]
  [HAVING 조건]
  [ORDER BY 속성명 [ASC | DESC]];
  ```

- 그룹함수 : GROUP BY 절에 지정된 그룹별로 속성의 값을 집계할 함수를 기술한다

- WINDOW 함수 : GROUP BY 절을 이용하지 않고 속성의 값을 집계할 함수를 기술한다

  - PARTITION BY : WINDOW 함수가 적용될 범위로 사용할 속성을 지정한다
  - ORDER BY : PARTITION 안에서 정렬 기준으로 사용할 속성을 지정한다

- GROUP BY절 : 특정 속성을 기준으로 그룹화하여 검색할 때 사용한다. 일반적으로 GROUP BY절은 그룹 함수와 함께 사용된다

- HAVING절 : GROUP BY와 함께 사용되며, 그룹에 대한 조건을 지정한다



### 그룹 함수 / WINDOW 함수

#### 그룹 함수

- GROUP BY절에 지정된 그룹별로 속성의 값을 집계할 때 사용
- COUNT(속성명) : 그룹별 튜플 수를 구하는 함수
- SUM(속성명) : 그룹별 합계를 구하는 함수
- AVG(속성명) : 그룹별 평균을 구하는 함수
- MAX(속성명) : 그룹별 최대값을 구하는 함수
- MIN(속성명) : 그룹별 최소값을 구하는 함수
- STDDEV(속성명) : 그룹별 표준편차를 구하는 함수
- VARIANCE(속성명) : 그룹별 분산을 구하는 함수
- ROLLUP(속성명, 속성명, ...)
  - 인수로 주어진 속성을 대상으로 그룹별 소계를 구하는 함수
  - 속성의 개수가 n개이면 n+1 레벨까지, 하위 레벨에서 상위 레벨 순으로 데이터가 집계된다
- CUBE(속성명, 속성명, ...)
  - ROLLUP과 유사한 형태이나 CUBE는 인수로 주어진 속성을 대상으로 모든 조합의 그룹별 소계를 구한다
  - 속성의 개수가 n개이면 n^2 레벨까지, 상위 레벨에서 하위 레벨 순으로 데이터가 집계된다

#### WINDOW 함수

- GROUP BY 절을 이용하지 않고 함수의 인수로 지정한 속성을 범위로 하여 속성의 값을 집계한다
- 함수의 인수로 지정한 속성이 대상 레코드의 범위가 되는데, 이를 윈도우(WINDOW)라고 부른다
- WINDOW 함수
  - ROW_NUMBER() : 윈도우별로 각 레코드에 대한 일련 번호를 반환한다
  - RANK() : 윈도우별로 순위를 반환하며, 공동 순위를 반영한다
  - DENSE_RANK() : 윈도우별로 순위를 반환하며, 공동 순위를 무시하고 순위를 부여한다



## 2 WINDOW 함수 이용 검색

- GROUP BY 절을 이용하지 않고 함수의 인수로 지정한 속성을 범위로 하여 속성의 값을 집계한다

- ```SQL
  SELECT 상여내역, 상여금, 
  	RANK() OVER (PARTITION BY 상여내역 ORDER BY 상여금 DESC) AS 상여금순위
  FROM 상여금;
  ```

  - 상여금 테이블에서 '상여내역'별로 '상여금'에 대한 순위를 구하는데, 순서는 내림차순이며 속성명은 '상여금 순위'로 하고 'RANK()' 함수를 이용함



## 3 그룹 지정 검색

- GROUP BY 절에 지정한 속성을 기준으로 자료를 그룹화하여 검색한다

- ```SQL
  SELECT 부서, 상여내역, SUM(상여금) AS 상여금합계
  FROM 상여금
  GROUP BY CUBE(부서, 상여내역);
  ```

  - 상여금 테이블의 '부서', '상여내역', '상여금'에 대해 부서별 상여내역 소계와 전체 합계를 검색. 속성명은 '상여금합계'로 하고, CUBE 함수를 사용