# 071 애플리케이션 성능 개선

## 1 소스 코드 최적화

- 소스 코드 최적화는 나쁜 코드(Bad Code)를 배제하고, 클린 코드(Clean Code)로 작성하는 것이다
- 클린 코드(Clean Code)
  - 누구나 쉽게 이해하고 수정 및 추가할 수 있는 단순, 명료한 코드, 즉 잘 작성된 코드를 의미한다
- 나쁜 코드(Bad Code)
  - 프로그램의 로직(Logic)이 복잡하고 이해하기 어려운 코드로, 코드의 로직이 서로 얽혀 있는 스파게티 코드, 동일한 처리 로직이 중복되게 작성된 코드 등이 여기에 해당한다
- 나쁜 코드로 작성된 애플리케이션의 코드를 클린 코드로 수정하면 애플리케이션의 성능이 개선된다
- 클린 코드 작성 원칙
  - 가독성
    - 누구든지 코드를 쉽게 읽을 수 있도록 작성한다
    - 코드 작성 시 이해하기 쉬운 용어를 사용하거나 들여쓰기 기능 등을 사용한다
  - 단순성
    - 코드를 간단하게 작성한다
    - 한 번에 한 가지를 처리하도록 코드를 작성하고 클래스/메소드/함수 등을 최소 단위로 분리한다
  - 의존성 배제
    - 코드가 다른 모듈에 미치는 영향을 최소화한다
    - 코드 변경 시 다른 부분에 영향이 없도록 작성한다
  - 중복성 최소화
    - 코드의 중복을 최소화한다
    - 중복된 코드는 삭제하고 공통된 코드를 사용한다
  - 추상화
    - 상위 클래스/메소드/함수에서는 간략하게 애플리케이션의 특성을 나타내고, 상세 내용은 하위 클래스/메소드/함수에서 구현한다



## 2 소스 코드 최적화 유형

- 클래스 분할 배치
  - 하나의 클래스는 하나의 역할만 수행하도록 응집도를 노이고, 크기를 작게 작성한다
- Loosely Coupled(느슨한 결합)
  - 인터페이스 클래스를 이용하여 추상화된 자료 구조와 메소드를 구현함으로써 클래스 간의 의존성을 최소화한다
- 코딩 형식 준수
  - 코드 작성 시 다음의 형식을 준수한다
  - 줄 바꿈 사용
  - 개념적 유사성이 높은 종속 함수 사용
  - 호출하는 함수는 선배치, 호출되는 함수는 후배치
  - 지역 변수는 각 함수의 맨 처음에 선언
- 좋은 이름 사용
  - 변수나 함수 등의 이름은 기억하기 좋은 이름, 발음이 쉬운 용어, 접두어 사용 등 기본적인 이름 명명규칙(Naming Rule)을 정의하고 규칙에 맞는 이름을 사용한다
- 적절한 주석문 사용
  - 소스 코드 작성 시 앞으로 해야 할 일을 기록하거나 중요한 코드를 강조할 때 주석문을 사용한다



## 3 소스 코드 품질 분석 도구

- 소스 코드 품질 분석 도구는 소스 코드의 코딩 스타일, 코드에 설정된 코딩 표준, 코드의 복잡도, 코드에 존재하는 메모리 누수 현상, 스레드 결함 등을 발견하기 위해 사용하는 분석 도구로, 크게 정적 분석 도구와 동적 분석 도구로 나뉜다
- 정적 분석 도구
  - 작성한 소스 코드를 실행하지 않고 코딩 표준이나 코딩 스타일, 결함 등을 확인하는 코드 분석 도구이다
  - 비교적 애플리케이션 개발 초기의 결함을 찾는데 사용되고, 개발 완료 시점에서는 개발된 소스 코드의 품질을 검증하는 차원에서 사용된다
  - 동적 분석 도구로는 발견하기 어려운 결함을 찾아내고, 소스 코드에서 코딩의 복잡도, 모델 의존성, 불일치성 등을 분석할 수 있다
  - 종류 : pmd, cppcheck, SonarQube, checkstyle, ccm ,cobertura 등
- 동적 분석 도구
  - 작성한 소스 코드를 실행하여 코드에 존재하는 메모리 누수, 스레드 결함 등을 분석하는 도구이다
  - 종류 : Avalanche, Valgrind 등



## 4 소스 코드 품질 분석 도구의 종류

- pmd
  - 소스 코드에 대한 미사용 변수, 최적화되지 않은 코드 등 결함을 유발할 수 있는 코드를 검사한다
  - Linux, Windows
- cppcheck
  - C/C++ 코드에 대한 메모리 누수, 오버플로우 등 분석
  - Windows
- SonarQube
  - 중복 코드, 복잡도, 코딩 설계 등을 분석하는 소스 분석 통합 플랫폼
  - Cross-Platform
- checkstyle
  - Java 코드에 대해 소스 코드 표준을 따르고 있는지 검사한다
  - 다양한 개발 도구에 통합하여 사용 가능하다
  - Cross-Platform
- ccm
  - 다양한 언어의 코드 복잡도를 분석한다
  - Cross-Platform
- cobertura
  - Java의 소스 코드 복잡도 분석 및 테스트 커버리지를 측정한다
  - Cross-Platform
- Avalanche
  - Valgrind 프레임워크 및 STP 기반으로 구현된다
  - 프로그램에 대한 결함 및 취약점 등을 분석한다
  - Linux, Android
- Valgrind
  - 프로그램 내에 존재하는 메모리 및 쓰레드 결함 등을 분석한다
  - Cross-Platform



## 5 애플리케이션 성능 개선 방법

### 소스 코드 최적화 기법을 통한 성능 개선

- 애플리케이션 개발 프레임워크의 코딩 표준을 설정한다
- 인터페이스 클래스를 이용하여 추상화된 자료 구조를 작성함으로써 의존성을 최소화하는 느슨한 결합(Loosely Coupled)의 코드르르 작성한다



### 아키텍처 조정을 통한 성능 개선

- 팩토리 메소드 패턴(Factory Method Pattern)을 이용하여 객체의 생성과 사용을 분리함으로써 소프트웨어의 의존성을 최소화한다



### 프로그램 호출 순서 조정을 통한 성능 개선

- 서로 연관된 내용은 세로로 가깝게 작성함으로써 밀집도를 높인다
- 유사성이 높은 함수나 코드를 가깝게 배치한다
- 호출하는 함수를 먼저 코딩하고, 호출되는 함수를 나중에 배치한다



### 소스 코드 품질 분석 도구를 활용한 애플리케이션 성능 개선

- 메모리 사용 최소화를 통한 성능 개선
  - String 클래스를 StringBuffer 또는 StringBuilder 클래스로 수정하여 코딩한다
    - String 클래스는 연산 시 매번 new 객체를 생성하여 Heap 메모리의 사용량이 증가하므로 속도가 저하도리 수 있지만, StringBuffer 또는 STringBuilder 클래스는 기존 객체의 크기를 변경시켜 처리하므로 성능이 개선된다
  - 반복 루프 내 불필요한 메소드의 호출이 반복되지 않도록 코딩한다
    - 반복 루프 내에서 메소드의 호출이 반복되는 코드를 루프 진입 전에 호출하도록 하거나 루프 내에서는 호출되지 않도록 소스 코드를 수정하여 성능을 개선한다
- 입출력 발생 최소화를 통한 성능 개선
  - 데이터의 입출력 요청이 있을 때마다 매번 읽어오기 보다는 일정 크기를 한 번에 읽어 들여 버퍼(Buffer)에 저장한 후 사용하는 BufferedReader, BufferdWriter 클래스를 이용한다



### System.out.println()을 사용하지 않음으로써 성능을 개선한다

- System.out.println()을 사용하여 파일이나 콘솔에 로그를 남기면 애플리케이션에 대기 시간이 발생하여 시스템의 성능 저하가 발생된다.
- 대신 Log4j를 사용하면 시스템 성능에 큰 영향을 미치지 않으면서 다양한 방법으로 로깅을 할 수 있다